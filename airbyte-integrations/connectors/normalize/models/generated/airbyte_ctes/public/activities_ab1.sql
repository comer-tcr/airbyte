{{ config(
    indexes = [{'columns':['_airbyte_emitted_at'],'type':'btree'}],
    unique_key = '_airbyte_ab_id',
    schema = "_airbyte_public",
    tags = [ "top-level-intermediate" ]
) }}
-- SQL model to parse JSON blob stored in a single column and extract into separated field columns as described by the JSON Schema
-- depends_on: {{ source('public', '_airbyte_raw_activities') }}
select
    {{ json_extract_scalar('_airbyte_data', ['last_notification_time'], ['last_notification_time']) }} as last_notification_time,
    {{ json_extract_scalar('_airbyte_data', ['location_street_number'], ['location_street_number']) }} as location_street_number,
    {{ json_extract_scalar('_airbyte_data', ['type_name'], ['type_name']) }} as type_name,
    {{ json_extract_scalar('_airbyte_data', ['reference_id'], ['reference_id']) }} as reference_id,
    {{ json_extract_scalar('_airbyte_data', ['location_route'], ['location_route']) }} as location_route,
    {{ json_extract_scalar('_airbyte_data', ['public_description'], ['public_description']) }} as public_description,
    {{ json_extract_scalar('_airbyte_data', ['notification_language_id'], ['notification_language_id']) }} as notification_language_id,
    {{ json_extract_scalar('_airbyte_data', ['subject'], ['subject']) }} as subject,
    {{ json_extract_scalar('_airbyte_data', ['type'], ['type']) }} as {{ adapter.quote('type') }},
    {{ json_extract_scalar('_airbyte_data', ['google_calendar_etag'], ['google_calendar_etag']) }} as google_calendar_etag,
    {{ json_extract_scalar('_airbyte_data', ['google_calendar_id'], ['google_calendar_id']) }} as google_calendar_id,
    {{ json_extract_scalar('_airbyte_data', ['deal_title'], ['deal_title']) }} as deal_title,
    {{ json_extract_scalar('_airbyte_data', ['id'], ['id']) }} as {{ adapter.quote('id') }},
    {{ json_extract_scalar('_airbyte_data', ['deal_id'], ['deal_id']) }} as deal_id,
    {{ json_extract_scalar('_airbyte_data', ['location_lat'], ['location_lat']) }} as location_lat,
    {{ json_extract_scalar('_airbyte_data', ['gcal_event_id'], ['gcal_event_id']) }} as gcal_event_id,
    {{ json_extract_scalar('_airbyte_data', ['busy_flag'], ['busy_flag']) }} as busy_flag,
    {{ json_extract_scalar('_airbyte_data', ['person_id'], ['person_id']) }} as person_id,
    {{ json_extract_scalar('_airbyte_data', ['location_long'], ['location_long']) }} as location_long,
    {{ json_extract_scalar('_airbyte_data', ['owner_name'], ['owner_name']) }} as owner_name,
    {{ json_extract_array('_airbyte_data', ['attendees'], ['attendees']) }} as attendees,
    {{ json_extract_scalar('_airbyte_data', ['person_name'], ['person_name']) }} as person_name,
    {{ json_extract_scalar('_airbyte_data', ['rec_rule_extension'], ['rec_rule_extension']) }} as rec_rule_extension,
    {{ json_extract_scalar('_airbyte_data', ['done'], ['done']) }} as done,
    {{ json_extract_scalar('_airbyte_data', ['created_by_user_id'], ['created_by_user_id']) }} as created_by_user_id,
    {{ json_extract_scalar('_airbyte_data', ['location_sublocality'], ['location_sublocality']) }} as location_sublocality,
    {{ json_extract_scalar('_airbyte_data', ['rec_rule'], ['rec_rule']) }} as rec_rule,
    {{ json_extract_scalar('_airbyte_data', ['location_admin_area_level_2'], ['location_admin_area_level_2']) }} as location_admin_area_level_2,
    {{ json_extract_scalar('_airbyte_data', ['user_id'], ['user_id']) }} as user_id,
    {{ json_extract_scalar('_airbyte_data', ['location_admin_area_level_1'], ['location_admin_area_level_1']) }} as location_admin_area_level_1,
    {{ json_extract_scalar('_airbyte_data', ['org_id'], ['org_id']) }} as org_id,
    {{ json_extract_scalar('_airbyte_data', ['conference_meeting_client'], ['conference_meeting_client']) }} as conference_meeting_client,
    {{ json_extract_scalar('_airbyte_data', ['note'], ['note']) }} as note,
    {{ json_extract_scalar('_airbyte_data', ['due_time'], ['due_time']) }} as due_time,
    {{ json_extract_scalar('_airbyte_data', ['rec_master_activity_id'], ['rec_master_activity_id']) }} as rec_master_activity_id,
    {{ json_extract_scalar('_airbyte_data', ['location_country'], ['location_country']) }} as location_country,
    {{ json_extract_scalar('_airbyte_data', ['active_flag'], ['active_flag']) }} as active_flag,
    {{ json_extract_scalar('_airbyte_data', ['duration'], ['duration']) }} as duration,
    {{ json_extract_scalar('_airbyte_data', ['location_postal_code'], ['location_postal_code']) }} as location_postal_code,
    {{ json_extract_scalar('_airbyte_data', ['update_time'], ['update_time']) }} as update_time,
    {{ json_extract('table_alias', '_airbyte_data', ['file'], ['file']) }} as {{ adapter.quote('file') }},
    {{ json_extract_scalar('_airbyte_data', ['update_user_id'], ['update_user_id']) }} as update_user_id,
    {{ json_extract_scalar('_airbyte_data', ['source_timezone'], ['source_timezone']) }} as source_timezone,
    {{ json_extract_scalar('_airbyte_data', ['person_dropbox_bcc'], ['person_dropbox_bcc']) }} as person_dropbox_bcc,
    {{ json_extract_scalar('_airbyte_data', ['conference_meeting_id'], ['conference_meeting_id']) }} as conference_meeting_id,
    {{ json_extract_scalar('_airbyte_data', ['org_name'], ['org_name']) }} as org_name,
    {{ json_extract_scalar('_airbyte_data', ['location_locality'], ['location_locality']) }} as location_locality,
    {{ json_extract_scalar('_airbyte_data', ['assigned_to_user_id'], ['assigned_to_user_id']) }} as assigned_to_user_id,
    {{ json_extract_scalar('_airbyte_data', ['lead_id'], ['lead_id']) }} as lead_id,
    {{ json_extract_array('_airbyte_data', ['participants'], ['participants']) }} as participants,
    {{ json_extract_scalar('_airbyte_data', ['location_subpremise'], ['location_subpremise']) }} as location_subpremise,
    {{ json_extract_scalar('_airbyte_data', ['company_id'], ['company_id']) }} as company_id,
    {{ json_extract_scalar('_airbyte_data', ['due_date'], ['due_date']) }} as due_date,
    {{ json_extract_scalar('_airbyte_data', ['reference_type'], ['reference_type']) }} as reference_type,
    {{ json_extract_scalar('_airbyte_data', ['last_notification_user_id'], ['last_notification_user_id']) }} as last_notification_user_id,
    {{ json_extract_scalar('_airbyte_data', ['calendar_sync_include_context'], ['calendar_sync_include_context']) }} as calendar_sync_include_context,
    {{ json_extract_scalar('_airbyte_data', ['marked_as_done_time'], ['marked_as_done_time']) }} as marked_as_done_time,
    {{ json_extract_scalar('_airbyte_data', ['location_formatted_address'], ['location_formatted_address']) }} as location_formatted_address,
    {{ json_extract_scalar('_airbyte_data', ['series'], ['series']) }} as series,
    {{ json_extract_scalar('_airbyte_data', ['conference_meeting_url'], ['conference_meeting_url']) }} as conference_meeting_url,
    {{ json_extract_scalar('_airbyte_data', ['location'], ['location']) }} as {{ adapter.quote('location') }},
    {{ json_extract_scalar('_airbyte_data', ['deal_dropbox_bcc'], ['deal_dropbox_bcc']) }} as deal_dropbox_bcc,
    {{ json_extract_scalar('_airbyte_data', ['add_time'], ['add_time']) }} as add_time,
    _airbyte_ab_id,
    _airbyte_emitted_at,
    {{ current_timestamp() }} as _airbyte_normalized_at
from {{ source('public', '_airbyte_raw_activities') }} as table_alias
-- activities
where 1 = 1

